<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>Blue Team Co-Pilot</title>
<style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#0a0e27;color:#e0e0e0}.wrap{max-width:900px;margin:40px auto;padding:24px;background:#12173a;border:1px solid #2a3150;border-radius:16px}label{display:block;margin:12px 0 6px;font-weight:600}select,input[type=file],button,textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid #384372;background:#0f1333;color:#e0e0e0}button{cursor:pointer;margin-top:14px}.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}.muted{color:#9aa4d3;font-size:.95em}.success{background:#143a24;padding:10px;border:1px solid #2e5941;border-radius:12px;margin-top:10px}.error{background:#3a1424;padding:10px;border:1px solid #8b4545;border-radius:12px;margin-top:10px}.switch{display:flex;align-items:center;gap:8px;margin-top:8px}a{color:#84b6ff}</style></head>
<body><div class="wrap"><h1>Blue Team Co-Pilot</h1><p class="muted">Choose an agent, upload artifacts, preview ZPA diffs, and compose a single unified enrichment comment.</p>
<label for="agent">Agent</label><select id="agent"></select>
<label for="files">Artifacts</label><input id="files" type="file" multiple />
<div class="switch"><input id="jira" type="checkbox" /><label for="jira">Create JIRA ticket (requires JIRA_ENABLE_WRITE=true)</label></div>
<div class="switch"><input id="analyze" type="checkbox" checked /><label for="analyze">Auto-analyze uploaded files for IoCs</label></div>
<label for="notes">Notes (optional)</label><textarea id="notes" rows="4" placeholder="Context, case refs, affected users, etc."></textarea>
<button id="go">Upload & Run</button>
<div id="out"></div>
<hr style="margin:24px 0; border-color:#2a3150"/>
<h2>ZPA Change Proposal</h2>
<label for="jiraKey">JIRA Issue Key (approval required)</label><input id="jiraKey" placeholder="SEC-123" />
<label for="zpaDesired">Desired ZPA Config (JSON)</label><textarea id="zpaDesired" rows="10" placeholder='{"applications":[...], "segments":[...]}'></textarea>
<div class="row"><button id="btnDiff">Preview ZPA Diff</button><button id="btnEnforce">Enforce (requires approvals)</button></div>
<hr style="margin:24px 0; border-color:#2a3150"/>
<h2>Unify & Comment</h2>
<label for="jiraKey2">JIRA Issue Key</label><input id="jiraKey2" placeholder="SEC-123" />
<div class="switch"><input id="postComment" type="checkbox" /><label for="postComment">Post to JIRA as a comment</label></div>
<button id="btnEnrichComment">Enrich & Comment</button>
<hr style="margin:24px 0; border-color:#2a3150"/>
<p class="muted">Metrics: <a href="/metrics" target="_blank">/metrics</a> | Health: <a href="/healthz" target="_blank">/healthz</a></p>
</div>
<script>
async function loadAgents(){const sel=document.getElementById('agent');const res=await fetch('/agents');const json=await res.json();for(const a of json.agents){const opt=document.createElement('option');opt.value=a.id;opt.textContent=`${a.name} (${a.id})`;sel.appendChild(opt);}}
function msg(html,cls='success'){const out=document.getElementById('out');const div=document.createElement('div');div.className=cls;div.innerHTML=html;out.prepend(div);}
async function uploadAndRun(){try{const sel=document.getElementById('agent');const files=document.getElementById('files').files;const jira=document.getElementById('jira').checked;const analyze=document.getElementById('analyze').checked;const notes=document.getElementById('notes').value;if(!sel.value)return msg('Pick an agent first.','error');if(!files.length)return msg('Attach at least one file.','error');const fd=new FormData();fd.append('agent_id',sel.value);fd.append('create_jira',jira?'true':'false');for(const f of files)fd.append('files',f);const up=await fetch('/upload',{method:'POST',body:fd});const upj=await up.json();window._lastSavedPaths=upj.saved||[];if(up.status!==200)throw new Error(JSON.stringify(upj));let analysis=null;if(analyze){const res=await fetch('/ingest/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({paths: upj.saved})});analysis=await res.json();}const run=await fetch('/tasks/run',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({agent_id: sel.value, input:{notes}})});const runj=await run.json();msg('<b>Uploaded:</b> '+upj.saved.join(', ') + (analysis ? '<br/><b>IoCs total:</b> '+analysis.iocs_total+'<br/><pre>'+JSON.stringify(analysis.results,null,2)+'</pre>':'') + '<br/><b>Task:</b> '+JSON.stringify(runj));}catch(e){msg('Error: '+e.message,'error');}}
async function zpaDiff(){try{const desired=document.getElementById('zpaDesired').value.trim();if(!desired)return msg('Provide desired ZPA JSON.','error');const res=await fetch('/zpa/diff',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({desired: JSON.parse(desired), fetch_current: false})});const j=await res.json();msg('<b>ZPA Diff:</b><br/><pre>'+JSON.stringify(j,null,2)+'</pre>');}catch(e){msg('Diff error: '+e.message,'error');}}
async function zpaEnforce(){try{const desired=document.getElementById('zpaDesired').value.trim();const key=document.getElementById('jiraKey').value.trim();if(!desired)return msg('Provide desired ZPA JSON.','error');if(!key)return msg('Provide a JIRA issue key for approval checking.','error');const diff=await fetch('/zpa/diff',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({desired: JSON.parse(desired), fetch_current: false})});const dj=await diff.json();const res=await fetch('/zpa/enforce',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({patch: dj.patch, jira_issue_key: key})});const j=await res.json();msg('<b>Enforce result:</b><br/><pre>'+JSON.stringify(j,null,2)+'</pre>');}catch(e){msg('Enforce error: '+e.message,'error');}}
async function enrichAndComment(){try{const key=document.getElementById('jiraKey2').value.trim();const post=document.getElementById('postComment').checked;const paths=(window._lastSavedPaths||[]);if(!paths.length)return msg('Upload files first so I know what to enrich.','error');const res=await fetch('/enrich/unified_comment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({paths, jira_issue_key: key||null, create_comment: !!post, include_idr: true, include_zpa: true})});const j=await res.json();msg('<b>Unified Enrichment:</b><br/><pre>'+JSON.stringify(j,null,2)+'</pre>');}catch(e){msg('Enrich error: '+e.message,'error');}}
document.getElementById('go').addEventListener('click', uploadAndRun);document.getElementById('btnDiff').addEventListener('click', zpaDiff);document.getElementById('btnEnforce').addEventListener('click', zpaEnforce);document.getElementById('btnEnrichComment').addEventListener('click', enrichAndComment);loadAgents();</script></body></html>
